---
title: 'å®æ—¶è¯­éŸ³ï¼ˆRealtimeï¼‰'
description: 'WebSocket å®æ—¶å¯¹è¯æ¥å£'
---

## ç®€ä»‹

Realtime API æä¾›ä½æ—¶å»¶çš„æ–‡æœ¬/è¯­éŸ³å®æ—¶å¯¹è¯èƒ½åŠ›ï¼Œé€šè¿‡ WebSocket å»ºç«‹é•¿è¿æ¥ï¼ŒæŒ‰äº‹ä»¶æµäº¤äº’ã€‚æ”¯æŒæ–‡æœ¬å’ŒéŸ³é¢‘ä¸¤ç§è¾“å…¥è¾“å‡ºæ¨¡å¼ï¼Œå¯å®ç°å®æ—¶è¯­éŸ³å¯¹è¯ã€æ–‡æœ¬å¯¹è¯ç­‰åŠŸèƒ½ã€‚

**æ¥å£åœ°å€**ï¼š
```
WSS wss://llm.ai-nebula.com/v1/realtime?model={model}
```

## è®¤è¯

<ParamField header="Authorization" type="string" required>
  Bearer Tokenï¼Œå¦‚ `Bearer sk-xxxxxxxxxx`
</ParamField>

## è¿æ¥å‚æ•°

<ParamField query="model" type="string" required>
  æ¨¡å‹åç§°ï¼Œæ”¯æŒçš„æ¨¡å‹ï¼š
  - `gpt-realtime` - GPT Realtime æ ‡å‡†ç‰ˆ
  - `gpt-realtime-mini` - GPT Realtime Mini ç‰ˆ
</ParamField>

## åŸºç¡€ä¿¡æ¯

| é¡¹ç›® | å†…å®¹ |
|------|------|
| **Base URL** | `wss://llm.ai-nebula.com` |
| **æ¥å£åœ°å€** | `/v1/realtime?model={model}` |
| **åè®®** | WebSocketï¼ˆJSON äº‹ä»¶æµï¼‰ |
| **éŸ³é¢‘æ ¼å¼** | PCM16 å•å£°é“ï¼Œé‡‡æ ·ç‡ 24000Hz |

## äº‹ä»¶ç±»å‹

### å®¢æˆ·ç«¯å‘é€äº‹ä»¶

| äº‹ä»¶ç±»å‹ | è¯´æ˜ | å¿…éœ€å­—æ®µ |
|---------|------|---------|
| `session.update` | è®¾ç½®/æ›´æ–°ä¼šè¯é…ç½®ï¼ˆè¿æ¥åé¦–å…ˆå‘é€ï¼‰ | `session` |
| `conversation.item.create` | å‘é€å¯¹è¯æ¶ˆæ¯ï¼ˆæ–‡æœ¬æˆ–éŸ³é¢‘ï¼‰ | `item` |
| `input_audio_buffer.append` | æµå¼æ¨é€éŸ³é¢‘æ•°æ®ï¼ˆBase64 ç¼–ç ï¼‰ | `audio` |
| `input_audio_buffer.commit` | æäº¤éŸ³é¢‘ç¼“å†²ï¼Œè§¦å‘å¤„ç† | æ—  |
| `response.create` | è¯·æ±‚ç”Ÿæˆå›å¤ï¼ˆå‘é€æ¶ˆæ¯åè°ƒç”¨ï¼‰ | æ—  |

### æœåŠ¡ç«¯è¿”å›äº‹ä»¶

| äº‹ä»¶ç±»å‹ | è¯´æ˜ | åŒ…å«å­—æ®µ |
|---------|------|---------|
| `session.created` | ä¼šè¯å·²åˆ›å»º | `session.id` |
| `session.updated` | ä¼šè¯é…ç½®å·²æ›´æ–° | `session` |
| `conversation.item.created` | å¯¹è¯é¡¹å·²åˆ›å»º | `item` |
| `response.created` | å›å¤å·²åˆ›å»º | `response.id` |
| `response.text.delta` | æ–‡æœ¬å¢é‡è¾“å‡º | `delta` |
| `response.text.done` | æ–‡æœ¬è¾“å‡ºå®Œæˆ | æ—  |
| `response.audio.delta` | éŸ³é¢‘å¢é‡è¾“å‡º | `delta` |
| `response.audio.done` | éŸ³é¢‘è¾“å‡ºå®Œæˆ | æ—  |
| `response.audio_transcript.delta` | éŸ³é¢‘è½¬å½•å¢é‡ | `delta` |
| `response.function_call_arguments.delta` | å‡½æ•°è°ƒç”¨å‚æ•°å¢é‡ | `delta` |
| `response.function_call_arguments.done` | å‡½æ•°è°ƒç”¨å‚æ•°å®Œæˆ | æ—  |
| `response.done` | æœ¬è½®å›å¤ç»“æŸï¼ŒåŒ…å«ä½¿ç”¨ç»Ÿè®¡ | `response.usage` |
| `error` | é”™è¯¯äº‹ä»¶ | `error` |

## ä¼šè¯é…ç½®

å»ºç«‹ WebSocket è¿æ¥åï¼Œé¦–å…ˆéœ€è¦å‘é€ `session.update` äº‹ä»¶æ¥é…ç½®ä¼šè¯å‚æ•°ã€‚

### ä¼šè¯é…ç½®ç¤ºä¾‹

```json
{
  "event_id": "evt_001",
  "type": "session.update",
  "session": {
    "modalities": ["text", "audio"],
    "instructions": "ä½ æ˜¯ä¸€ä¸ªå‹å¥½çš„åŠ©æ‰‹",
    "voice": "alloy",
    "temperature": 0.8,
    "input_audio_format": "pcm16",
    "output_audio_format": "pcm16"
  }
}
```

### ä¼šè¯å‚æ•°è¯´æ˜

<ParamField body="session.modalities" type="array" default='["text"]'>
  æ”¯æŒçš„äº¤äº’æ¨¡å¼ï¼Œå¯é€‰å€¼ï¼š
  - `"text"` - æ–‡æœ¬æ¨¡å¼
  - `"audio"` - éŸ³é¢‘æ¨¡å¼
  å¯åŒæ—¶åŒ…å«å¤šä¸ªæ¨¡å¼ï¼Œå¦‚ `["text", "audio"]`
</ParamField>

<ParamField body="session.instructions" type="string">
  ç³»ç»Ÿæç¤ºè¯ï¼Œç”¨äºè®¾ç½®åŠ©æ‰‹çš„è¡Œä¸ºå’Œè§’è‰²
</ParamField>

<ParamField body="session.voice" type="string" default="alloy">
  è¯­éŸ³ç±»å‹ï¼Œå¯é€‰å€¼ï¼š`alloy`ã€`echo`ã€`fable`ã€`onyx`ã€`nova`ã€`shimmer`
</ParamField>

<ParamField body="session.temperature" type="number" default="1.0">
  æ¸©åº¦å‚æ•°ï¼Œæ§åˆ¶è¾“å‡ºçš„éšæœºæ€§ï¼ŒèŒƒå›´ï¼š0.0 - 2.0
</ParamField>

<ParamField body="session.input_audio_format" type="string" default="pcm16">
  è¾“å…¥éŸ³é¢‘æ ¼å¼ï¼Œç›®å‰ä»…æ”¯æŒ `pcm16`
</ParamField>

<ParamField body="session.output_audio_format" type="string" default="pcm16">
  è¾“å‡ºéŸ³é¢‘æ ¼å¼ï¼Œç›®å‰ä»…æ”¯æŒ `pcm16`
</ParamField>

<ParamField body="session.tools" type="array">
  å·¥å…·å‡½æ•°åˆ—è¡¨ï¼Œæ”¯æŒå‡½æ•°è°ƒç”¨åŠŸèƒ½
</ParamField>

<ParamField body="session.tool_choice" type="string">
  å·¥å…·é€‰æ‹©ç­–ç•¥ï¼š`auto`ã€`required`ã€`none`
</ParamField>

## å‘é€æ¶ˆæ¯

### æ–‡æœ¬æ¶ˆæ¯ç¤ºä¾‹

```json
{
  "event_id": "evt_002",
  "type": "conversation.item.create",
  "item": {
    "type": "message",
    "role": "user",
    "content": [
      { "type": "input_text", "text": "ä½ å¥½ï¼Œè¯·ç®€å•ä»‹ç»ä¸€ä¸‹ä½ è‡ªå·±ã€‚" }
    ]
  }
}
```

### éŸ³é¢‘æ¶ˆæ¯ç¤ºä¾‹

éŸ³é¢‘æ¶ˆæ¯éœ€è¦å…ˆé€šè¿‡ `input_audio_buffer.append` æ¨é€éŸ³é¢‘æ•°æ®ï¼Œç„¶åè°ƒç”¨ `input_audio_buffer.commit` æäº¤ï¼š

```json
// 1. æ¨é€éŸ³é¢‘æ•°æ®ï¼ˆå¯å¤šæ¬¡è°ƒç”¨ï¼‰
{
  "event_id": "evt_003",
  "type": "input_audio_buffer.append",
  "audio": "base64_encoded_audio_data..."
}

// 2. æäº¤éŸ³é¢‘ç¼“å†²
{
  "event_id": "evt_004",
  "type": "input_audio_buffer.commit"
}

// 3. åˆ›å»ºå¯¹è¯é¡¹
{
  "event_id": "evt_005",
  "type": "conversation.item.create",
  "item": {
    "type": "message",
    "role": "user",
    "content": [
      { "type": "input_audio", "audio": "" }
    ]
  }
}
```

### è¯·æ±‚ç”Ÿæˆå›å¤

å‘é€æ¶ˆæ¯åï¼Œéœ€è¦è°ƒç”¨ `response.create` æ¥è§¦å‘ç”Ÿæˆï¼š

```json
{
  "event_id": "evt_006",
  "type": "response.create"
}
```

## å®Œæ•´ç¤ºä¾‹

### Python ç¤ºä¾‹

```python
import json
import websocket
import threading

API_BASE = "wss://llm.ai-nebula.com"
API_KEY = "sk-xxxxxxxxxx"
MODEL = "gpt-realtime"

def on_message(ws, message):
    """å¤„ç†æœåŠ¡ç«¯è¿”å›çš„æ¶ˆæ¯"""
    event = json.loads(message)
    event_type = event.get("type")
    
    if event_type == "session.created":
        print(f"âœ… ä¼šè¯å·²åˆ›å»º: {event.get('session', {}).get('id')}")
    elif event_type == "response.text.delta":
        # æµå¼è¾“å‡ºæ–‡æœ¬
        delta = event.get("delta", "")
        print(delta, end="", flush=True)
    elif event_type == "response.done":
        # å›å¤å®Œæˆï¼Œæ˜¾ç¤ºä½¿ç”¨ç»Ÿè®¡
        usage = event.get("response", {}).get("usage", {})
        print(f"\n\nğŸ“Š Token ä½¿ç”¨: {usage.get('total_tokens', 0)}")
    elif event_type == "error":
        error = event.get("error", {})
        print(f"\nâŒ é”™è¯¯: {error.get('message', 'æœªçŸ¥é”™è¯¯')}")

def on_error(ws, error):
    print(f"âŒ WebSocket é”™è¯¯: {error}")

def on_close(ws, close_status_code, close_msg):
    print("ğŸ”Œ è¿æ¥å·²å…³é—­")

def on_open(ws):
    """è¿æ¥å»ºç«‹åå‘é€åˆå§‹æ¶ˆæ¯"""
    # 1. é…ç½®ä¼šè¯
    session_config = {
        "event_id": "evt_001",
        "type": "session.update",
        "session": {
            "modalities": ["text"],
            "instructions": "ä½ æ˜¯ä¸€ä¸ªç®€æ´çš„åŠ©æ‰‹",
            "temperature": 0.8
        }
    }
    ws.send(json.dumps(session_config, ensure_ascii=False))
    
    # 2. å‘é€ç”¨æˆ·æ¶ˆæ¯
    user_message = {
        "event_id": "evt_002",
        "type": "conversation.item.create",
        "item": {
            "type": "message",
            "role": "user",
            "content": [
                {"type": "input_text", "text": "ç”¨ä¸€å¥è¯ä»‹ç» Nebulaã€‚"}
            ]
        }
    }
    ws.send(json.dumps(user_message, ensure_ascii=False))
    
    # 3. è¯·æ±‚ç”Ÿæˆå›å¤
    response_create = {
        "event_id": "evt_003",
        "type": "response.create"
    }
    ws.send(json.dumps(response_create, ensure_ascii=False))

# å»ºç«‹ WebSocket è¿æ¥
ws = websocket.WebSocketApp(
    f"{API_BASE}/v1/realtime?model={MODEL}",
    header={"Authorization": f"Bearer {API_KEY}"},
    on_message=on_message,
    on_error=on_error,
    on_close=on_close,
    on_open=on_open
)

# è¿è¡Œ WebSocketï¼ˆé˜»å¡ï¼‰
ws.run_forever()
```

### JavaScript ç¤ºä¾‹

```javascript
const API_BASE = 'wss://llm.ai-nebula.com';
const API_KEY = 'sk-xxxxxxxxxx';
const MODEL = 'gpt-realtime';

const ws = new WebSocket(`${API_BASE}/v1/realtime?model=${MODEL}`, [], {
  headers: {
    'Authorization': `Bearer ${API_KEY}`
  }
});

ws.onopen = () => {
  console.log('âœ… WebSocket è¿æ¥å·²å»ºç«‹');
  
  // 1. é…ç½®ä¼šè¯
  ws.send(JSON.stringify({
    event_id: 'evt_001',
    type: 'session.update',
    session: {
      modalities: ['text'],
      instructions: 'ä½ æ˜¯ä¸€ä¸ªç®€æ´çš„åŠ©æ‰‹',
      temperature: 0.8
    }
  }));
  
  // 2. å‘é€ç”¨æˆ·æ¶ˆæ¯
  ws.send(JSON.stringify({
    event_id: 'evt_002',
    type: 'conversation.item.create',
    item: {
      type: 'message',
      role: 'user',
      content: [
        { type: 'input_text', text: 'ç”¨ä¸€å¥è¯ä»‹ç» Nebulaã€‚' }
      ]
    }
  }));
  
  // 3. è¯·æ±‚ç”Ÿæˆå›å¤
  ws.send(JSON.stringify({
    event_id: 'evt_003',
    type: 'response.create'
  }));
};

ws.onmessage = (event) => {
  const message = JSON.parse(event.data);
  const eventType = message.type;
  
  switch (eventType) {
    case 'session.created':
      console.log('âœ… ä¼šè¯å·²åˆ›å»º:', message.session?.id);
      break;
    case 'response.text.delta':
      // æµå¼è¾“å‡ºæ–‡æœ¬
      process.stdout.write(message.delta || '');
      break;
    case 'response.done':
      // å›å¤å®Œæˆ
      const usage = message.response?.usage;
      console.log('\n\nğŸ“Š Token ä½¿ç”¨:', usage?.total_tokens || 0);
      break;
    case 'error':
      console.error('âŒ é”™è¯¯:', message.error?.message);
      break;
  }
};

ws.onerror = (error) => {
  console.error('âŒ WebSocket é”™è¯¯:', error);
};

ws.onclose = () => {
  console.log('ğŸ”Œ è¿æ¥å·²å…³é—­');
};
```

<ResponseExample>
```json
{ "type": "session.created", "session": { "id": "sess_xxx" } }
{ "type": "response.created", "response": { "id": "resp_xxx" } }
{ "type": "response.text.delta", "delta": "ä½ å¥½ï¼æˆ‘æ˜¯" }
{ "type": "response.text.delta", "delta": " Nebula çš„å®æ—¶åŠ©æ‰‹ã€‚" }
{
  "type": "response.done",
  "response": {
    "usage": {
      "total_tokens": 123,
      "input_tokens": 45,
      "output_tokens": 78
    }
  }
}
```
</ResponseExample>

## å“åº”ç¤ºä¾‹

<ResponseExample>
```json
// ä¼šè¯åˆ›å»ºæˆåŠŸ
{ 
  "type": "session.created", 
  "session": { "id": "sess_xxx" } 
}

// å›å¤åˆ›å»º
{ 
  "type": "response.created", 
  "response": { "id": "resp_xxx" } 
}

// æ–‡æœ¬å¢é‡è¾“å‡º
{ 
  "type": "response.text.delta", 
  "delta": "ä½ å¥½ï¼æˆ‘æ˜¯" 
}

{ 
  "type": "response.text.delta", 
  "delta": " Nebula çš„å®æ—¶åŠ©æ‰‹ã€‚" 
}

// æ–‡æœ¬è¾“å‡ºå®Œæˆ
{ 
  "type": "response.text.done" 
}

// æœ¬è½®å›å¤ç»“æŸï¼ŒåŒ…å«ä½¿ç”¨ç»Ÿè®¡
{
  "type": "response.done",
  "response": {
    "usage": {
      "total_tokens": 123,
      "input_tokens": 45,
      "output_tokens": 78,
      "input_token_details": {
        "text_tokens": 45,
        "audio_tokens": 0
      },
      "output_token_details": {
        "text_tokens": 78,
        "audio_tokens": 0
      }
    }
  }
}
```
</ResponseExample>

## é”™è¯¯å¤„ç†

### é”™è¯¯äº‹ä»¶æ ¼å¼

```json
{
  "type": "error",
  "error": {
    "type": "invalid_request_error",
    "message": "é”™è¯¯æè¿°",
    "code": "error_code"
  }
}
```

### å¸¸è§é”™è¯¯

| é”™è¯¯ç±»å‹ | è§¦å‘åœºæ™¯ | è§£å†³æ–¹æ³• |
|---------|---------|---------|
| `authentication_error` | API Key æ— æ•ˆæˆ–æœªæˆæƒ | ç¡®è®¤ Authorization å¤´ä¸­ API Key æœ‰æ•ˆ |
| `invalid_request_error` | è¯·æ±‚æ ¼å¼é”™è¯¯ | æ£€æŸ¥äº‹ä»¶æ ¼å¼å’Œå¿…éœ€å­—æ®µ |
| `model_not_found` | æ¨¡å‹åç§°é”™è¯¯ | ä»…æ”¯æŒ `gpt-realtime` æˆ– `gpt-realtime-mini` |
| `audio_decode_error` | éŸ³é¢‘æ ¼å¼ä¸æ­£ç¡® | ç¡®ä¿ PCM16 å•å£°é“ã€é‡‡æ ·ç‡ 24000Hz |
| `rate_limit_error` | è¯·æ±‚é¢‘ç‡è¿‡é«˜ | é™ä½è¯·æ±‚é¢‘ç‡æˆ–ç­‰å¾…åé‡è¯• |
| `server_error` | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ | ç¨åé‡è¯•æˆ–è”ç³»æŠ€æœ¯æ”¯æŒ |

## éŸ³é¢‘æ ¼å¼è¦æ±‚

### è¾“å…¥éŸ³é¢‘

- **æ ¼å¼**ï¼šPCM16ï¼ˆ16-bit PCMï¼‰
- **å£°é“**ï¼šå•å£°é“ï¼ˆMonoï¼‰
- **é‡‡æ ·ç‡**ï¼š24000 Hz
- **ç¼–ç **ï¼šBase64 ç¼–ç åé€šè¿‡ `input_audio_buffer.append` å‘é€

### è¾“å‡ºéŸ³é¢‘

- **æ ¼å¼**ï¼šPCM16ï¼ˆ16-bit PCMï¼‰
- **å£°é“**ï¼šå•å£°é“ï¼ˆMonoï¼‰
- **é‡‡æ ·ç‡**ï¼š24000 Hz
- **ç¼–ç **ï¼šBase64 ç¼–ç ï¼Œé€šè¿‡ `response.audio.delta` äº‹ä»¶è¿”å›

## ä½¿ç”¨æµç¨‹

1. **å»ºç«‹è¿æ¥**ï¼šé€šè¿‡ WebSocket è¿æ¥åˆ° `wss://llm.ai-nebula.com/v1/realtime?model={model}`
2. **é…ç½®ä¼šè¯**ï¼šå‘é€ `session.update` äº‹ä»¶é…ç½®ä¼šè¯å‚æ•°
3. **å‘é€æ¶ˆæ¯**ï¼š
   - æ–‡æœ¬æ¨¡å¼ï¼šå‘é€ `conversation.item.create` äº‹ä»¶
   - éŸ³é¢‘æ¨¡å¼ï¼šå…ˆå‘é€ `input_audio_buffer.append` æ¨é€éŸ³é¢‘ï¼Œç„¶å `input_audio_buffer.commit` æäº¤ï¼Œæœ€åå‘é€ `conversation.item.create`
4. **è¯·æ±‚å›å¤**ï¼šå‘é€ `response.create` äº‹ä»¶è§¦å‘ç”Ÿæˆ
5. **æ¥æ”¶å›å¤**ï¼šç›‘å¬ `response.text.delta` æˆ– `response.audio.delta` äº‹ä»¶æ¥æ”¶å¢é‡è¾“å‡º
6. **å®Œæˆå¤„ç†**ï¼šæ”¶åˆ° `response.done` äº‹ä»¶åï¼Œå¯æŸ¥çœ‹ `usage` ç»Ÿè®¡ä¿¡æ¯

## æ³¨æ„äº‹é¡¹

<Note>
- **å¿…éœ€æ­¥éª¤**ï¼šå»ºç«‹è¿æ¥åå¿…é¡»å…ˆå‘é€ `session.update` é…ç½®ä¼šè¯
- **è§¦å‘å›å¤**ï¼šå‘é€æ¶ˆæ¯åå¿…é¡»è°ƒç”¨ `response.create` æ‰èƒ½è§¦å‘ç”Ÿæˆ
- **éŸ³é¢‘æ ¼å¼**ï¼šéŸ³é¢‘å¿…é¡»ä¸º PCM16 å•å£°é“ 24000Hzï¼ŒBase64 ç¼–ç 
- **äº‹ä»¶ ID**ï¼šå»ºè®®ä¸ºæ¯ä¸ªäº‹ä»¶è®¾ç½®å”¯ä¸€çš„ `event_id`ï¼Œä¾¿äºè¿½è¸ªå’Œè°ƒè¯•
- **è¿æ¥ç®¡ç†**ï¼šä¿æŒ WebSocket è¿æ¥æ´»è·ƒï¼Œé¿å…é¢‘ç¹æ–­å¼€é‡è¿
- **é”™è¯¯å¤„ç†**ï¼šç›‘å¬ `error` äº‹ä»¶å¹¶å®ç°é€‚å½“çš„é”™è¯¯å¤„ç†é€»è¾‘
- **ä¾èµ–åº“**ï¼š
  - Python: `pip install websocket-client`
  - JavaScript: ä½¿ç”¨åŸç”Ÿ `WebSocket` API æˆ– `ws` åº“
</Note>

## æœ€ä½³å®è·µ

1. **è¿æ¥å¤ç”¨**ï¼šå°½é‡å¤ç”¨åŒä¸€ä¸ª WebSocket è¿æ¥è¿›è¡Œå¤šè½®å¯¹è¯ï¼Œå‡å°‘è¿æ¥å¼€é”€
2. **é”™è¯¯é‡è¯•**ï¼šå®ç°æŒ‡æ•°é€€é¿é‡è¯•æœºåˆ¶å¤„ç†ç½‘ç»œé”™è¯¯
3. **éŸ³é¢‘ç¼“å†²**ï¼šéŸ³é¢‘æ•°æ®å»ºè®®åˆ†å—å‘é€ï¼Œé¿å…å•æ¬¡å‘é€è¿‡å¤§
4. **ä½¿ç”¨ç»Ÿè®¡**ï¼šå…³æ³¨ `response.done` ä¸­çš„ `usage` ä¿¡æ¯ï¼Œåˆç†æ§åˆ¶æˆæœ¬
5. **è¶…æ—¶å¤„ç†**ï¼šè®¾ç½®åˆç†çš„è¶…æ—¶æ—¶é—´ï¼Œé¿å…é•¿æ—¶é—´ç­‰å¾…
